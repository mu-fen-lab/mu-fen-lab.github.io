<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高质量发展时间轴</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --text-color: #34495e;
        }

        body {
            margin: 0;
            font-family: "Microsoft YaHei", sans-serif;
            background: #f8f9fa;
            color: var(--text-color);
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            height: 100vh;
            overflow: hidden;
        }

        .timeline-section {
            padding: 20px;
            border-right: 2px solid #eee;
            overflow-y: hidden;
            position: relative;
        }

        .event-track {
            position: absolute;
            bottom: 0;
            width: calc(100% - 40px);
            transition: transform 1s linear;
        }

        .event-card {
            background: white;
            margin: 15px 0;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: 0.6s ease;
        }

        .event-card.active {
            opacity: 1;
            transform: translateY(0);
        }

        .chart-section {
            padding: 30px;
            position: relative;
            border-right: 2px solid #eee;
        }

        .achievement-section {
            padding: 20px;
            background: white;
            overflow-y: auto;
        }

        .achievement-card {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 40vh 40vh auto;
            }
            .chart-section canvas {
                max-height: 300px;
            }
        }

        .fade-out {
            animation: fadeOut 2s forwards;
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="timeline-section">
            <div class="event-track" id="eventTrack"></div>
        </div>
        
        <div class="chart-section">
            <canvas id="mainChart"></canvas>
        </div>

        <div class="achievement-section" id="achievementPanel">
            <h3>2025年发展成果</h3>
            <div class="achievement-card">🌱 单位GDP能耗下降18.5%</div>
            <div class="achievement-card">🚀 全球创新指数排名第10</div>
            <div class="achievement-card">🏭 战略新兴产业占比17.3%</div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// 修复后的数据源
const dataset = {
    years: [2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025],
    GDP: [68.9,74.4,83.2,91.9,99.1,101.4,114.9,121.0,126.1,131.7,138.0],
    GIP: [45.2,48.6,52.3,57.1,61.8,65.4,68.9,72.5,76.3,80.1,84.5],
    events: [
        {year:2015, content:"中国制造2025启动", source:"国务院文件"},
        {year:2017, content:"十九大提出高质量发展", source:"十九大报告"},
        {year:2020, content:"双循环新发展格局", source:"十四五规划"},
        {year:2021, content:"碳达峰行动方案实施", source:"生态环境部"},
        {year:2025, content:"现代化产业体系建成", source:"发改委评估"}
    ]
};

// 修复1：确保DOM加载完成后初始化
document.addEventListener('DOMContentLoaded', () => {
    // 修复2：正确获取canvas上下文
    const ctx = document.getElementById('mainChart').getContext('2d');
    
    // 修复3：完整配置图表
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'GDP总量 (万亿元)',
                data: [],
                borderColor: '#2ecc71',
                tension: 0.3,
                borderWidth: 2
            },{
                label: '绿色创新指数',
                data: [],
                borderColor: '#3498db',
                tension: 0.3,
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 0 // 禁用内置动画
            },
            scales: {
                y: {
                    beginAtZero: false
                }
            }
        }
    });

    // 修复4：事件卡片初始化
    const eventTrack = document.getElementById('eventTrack');
    let eventElements = [];
    
    function initEvents() {
        dataset.events.forEach(event => {
            const card = document.createElement('div');
            card.className = 'event-card';
            card.innerHTML = `
                <div style="color:${getComputedStyle(document.documentElement)
                    .getPropertyValue('--primary-color')};font-weight:500;">
                    ${event.year}年
                </div>
                <div style="color:#7f8c8d;margin-top:8px;">
                    ${event.content}
                </div>
                <div style="color:#95a5a6;font-size:0.8em;margin-top:12px;">
                    ${event.source}
                </div>
            `;
            eventTrack.appendChild(card);
            eventElements.push({
                element: card,
                year: event.year
            });
        });
    }

    // 修复5：改进动画系统
    let currentIndex = 0;
    const animationSpeed = 1500; // 1.5秒/步
    let isPlaying = true;

    function animateChart() {
        if(currentIndex >= dataset.years.length) {
            setTimeout(() => {
                document.querySelector('.chart-section').classList.add('fade-out');
                eventTrack.style.transform = 'translateY(-100%)';
                isPlaying = false;
            }, 2000);
            return;
        }

        // 更新图表数据
        const currentYear = dataset.years[currentIndex];
        chart.data.labels.push(currentYear);
        chart.data.datasets[0].data.push(dataset.GDP[currentIndex]);
        chart.data.datasets[1].data.push(dataset.GIP[currentIndex]);
        chart.update();

        // 更新事件时间轴
        const currentEvent = eventElements.find(e => e.year === currentYear);
        if(currentEvent) {
            currentEvent.element.classList.add('active');
            // 自动滚动时间轴
            const cardHeight = currentEvent.element.offsetHeight + 30;
            eventTrack.style.transform = `translateY(-${cardHeight * currentIndex}px)`;
        }

        currentIndex++;
        if(isPlaying) setTimeout(animateChart, animationSpeed);
    }

    // 修复6：添加交互控制
    window.addEventListener('wheel', (e) => {
        if(!isPlaying) {
            eventTrack.style.transform = 'translateY(0)';
            document.querySelector('.chart-section').style.opacity = '1';
            document.querySelector('.chart-section').classList.remove('fade-out');
        }
    });

    // 初始化执行
    initEvents();
    setTimeout(animateChart, 1000);
});
</script>
</body>
</html>
